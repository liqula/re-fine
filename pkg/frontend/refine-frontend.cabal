-- *NOT* created by hpack any more, because hpack does not support to
-- specify js-sources.
--
-- losely related: https://github.com/sol/hpack/issues/136

name:           refine-frontend
version:        0.0.0.0
synopsis:       Refine frontend
description:    Please see README.md
category:       Web
homepage:       https://github.com/fisx/refine
author:         Andor Penzes <andor.penzes@gmail.com>,
                Matthias Fischmann <mf@zerobuzz.net>,
                Nicole Rauch <info@nicole-rauch.de>
maintainer:     mf@zerobuzz.net
copyright:      2017-2022 zerobuzz.net
license:        AGPL
license-file:   LICENSE
build-type:     Simple
cabal-version:  >= 1.10

-- (`stack build --ghc-options -Wwarn` does not override the
-- ghc-options set in the cabal targets below, so we work with a flag
-- instead.)
flag ghc-warn-error
  default: True

library
  hs-source-dirs:
      src
  ghc-options: -j -Wall -Wno-redundant-constraints
  if flag(ghc-warn-error)
      ghc-options: -Werror

  if impl(ghcjs)
    build-depends: ghcjs-base
  if !impl(ghcjs)
    build-depends: ghcjs-base-stub

  build-depends:
      aeson
    , base >= 4.7 && < 5
    , basic-sop
    , containers
    , data-default
    , deepseq
    , functor-infix
    , hspec
    , http-api-data
    , i18n
    , json-sop
    , language-css
    , lens
    , mtl
    , pretty-show
    , QuickCheck
    , quickcheck-instances
    , react-hs
    , react-hs-servant
    , refine-common
    , refine-prelude
    , string-conversions
    , text
    , time
    , transformers
    , unordered-containers
  exposed-modules:
      -- we can't have hspec, but at least we have bash and find and perl...  :)
      -- find src -name '*.hs' -exec perl -ne '/^module (\S+)[^\S]/ && print "      $1\n"' {} \; | sort
      React.Flux.Missing
      Refine.Frontend.Colors
      Refine.Frontend.Contribution.Bubble
      Refine.Frontend.Contribution.Dialog
      Refine.Frontend.Contribution.Discussion
      Refine.Frontend.Contribution.QuickCreate
      Refine.Frontend.Contribution.Store
      Refine.Frontend.Contribution.Types
      Refine.Frontend.CS
      Refine.Frontend.Document.Document
      Refine.Frontend.Document.FFI
      Refine.Frontend.Document.FFI.Types
      Refine.Frontend.Document.Store
      Refine.Frontend.Document.Types
      Refine.Frontend.Header.DiffToolbar
      Refine.Frontend.Header.DocumentHeader
      Refine.Frontend.Header.EditToolbar
      Refine.Frontend.Header.Heading
      Refine.Frontend.Header.Store
      Refine.Frontend.Header.Toolbar
      Refine.Frontend.Header.Types
      Refine.Frontend.Icon
      Refine.Frontend.Icon.Types
      Refine.Frontend.Login.Component
      Refine.Frontend.Login.Status
      Refine.Frontend.Login.Store
      Refine.Frontend.Login.Types
      Refine.Frontend.MainMenu.Component
      Refine.Frontend.MainMenu.Store
      Refine.Frontend.MainMenu.Types
      Refine.Frontend.Orphans
      Refine.Frontend.Prelude
      Refine.Frontend.Rest
      Refine.Frontend.Screen.Calculations
      Refine.Frontend.Screen.Store
      Refine.Frontend.Screen.Types
      Refine.Frontend.Screen.WindowSize
      Refine.Frontend.Store
      Refine.Frontend.Store.Types
      Refine.Frontend.Test.Console
      Refine.Frontend.Test.Enzyme
      Refine.Frontend.Test.Enzyme.Class
      Refine.Frontend.Test.Enzyme.Class.Internal
      Refine.Frontend.Test.Enzyme.Core
      Refine.Frontend.Test.Enzyme.ReactWrapper
      Refine.Frontend.Test.Enzyme.ShallowWrapper
      Refine.Frontend.Test.Marshal
      Refine.Frontend.Test.Store
      Refine.Frontend.ThirdPartyViews
      Refine.Frontend.TKey
      Refine.Frontend.Translation.Store
      Refine.Frontend.Types
      Refine.Frontend.Util
      Refine.Frontend.Views
      Refine.Frontend.Views.Types
      Refine.Frontend.Workbench
  default-language: Haskell2010

executable refine-frontend
  main-is: Main.hs
  hs-source-dirs: app
  ghc-options: -j -Wall -Wno-redundant-constraints
  if flag(ghc-warn-error)
      ghc-options: -Werror

  if impl(ghcjs)
    build-depends: ghcjs-base
  if !impl(ghcjs)
    build-depends: ghcjs-base-stub

  cpp-options: -DGHCJS_BROWSER
  build-depends:
      base >= 4.7 && < 5
    , react-hs
    , refine-frontend
  default-language: Haskell2010

test-suite spec
  type: exitcode-stdio-1.0
  main-is: Main.hs
  hs-source-dirs:
      test
  ghc-options: -j -Wall -Wno-redundant-constraints -threaded -rtsopts -with-rtsopts=-N
  if flag(ghc-warn-error)
      ghc-options: -Werror

  if impl(ghcjs)
    build-depends: ghcjs-base
  if !impl(ghcjs)
    build-depends: ghcjs-base-stub

  build-depends:
      aeson
    , base >= 4.7 && < 5
    , basic-sop
    , containers
    , deepseq
    , hspec
    , hspec-core
    , http-api-data
    , i18n
    , json-sop
    , language-css
    , lens
    , QuickCheck
    , quickcheck-instances
    , react-hs
    , react-hs-servant
    , refine-common
    , refine-frontend
    , refine-prelude
    , string-conversions
    , text
    , time
    , unordered-containers
  other-modules:
      -- (echo '      Spec'; (find test -name '*.hs' -exec perl -ne '/^module (\S+)[^\S]/ && print "      $1\n"' {} \;)) | sort
      AllModules
      Main
      Refine.Frontend.Contribution.BubbleSpec
      Refine.Frontend.Contribution.DialogSpec
      Refine.Frontend.Contribution.DiscussionSpec
      Refine.Frontend.Contribution.QuickCreateSpec
      Refine.Frontend.Document.DocumentSpec
      Refine.Frontend.Header.DocumentHeaderSpec
      Refine.Frontend.Header.HeadingSpec
      Refine.Frontend.Header.ToolbarSpec
      Refine.Frontend.IconSpec
      Refine.Frontend.MainMenuSpec
      Refine.Frontend.OrphansSpec
      Refine.Frontend.StoreSpec
      Refine.Frontend.ThirdPartyViewsSpec
      Refine.Frontend.UtilSpec
      Refine.Frontend.ViewsSpec
      Spec
  js-sources:
      jsbits/hookup.js
      jsbits/util.js
      jsbits/test.js
  default-language: Haskell2010

-- `stack bench` seems not to work with ghcjs
--
-- to run the benchmark, first build it with `stack bench`
-- then run "node `stack path --dist-dir`/build/bench/bench.jsexe/all.js"
benchmark bench
  type: exitcode-stdio-1.0
  main-is: Main.hs
  hs-source-dirs:
      bench
  ghc-options: -j -Wall -Wno-redundant-constraints -threaded -rtsopts -with-rtsopts=-N
  if flag(ghc-warn-error)
      ghc-options: -Werror

  build-depends:
      base >= 4.7 && < 5
    , aeson
    , bytestring
    , containers
    , deepseq
    , QuickCheck
    , refine-common
    , refine-frontend
    , string-conversions
    , time
  js-sources:
      jsbits/hookup.js
      jsbits/util.js
      jsbits/test.js
  default-language: Haskell2010
